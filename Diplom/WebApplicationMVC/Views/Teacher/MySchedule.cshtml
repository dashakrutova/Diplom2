@model WebApplicationMVC.ViewModels.Teachers.CalendarViewModel

<head>
    <link rel="stylesheet" href="~/css/mySchedule.css" asp-append-version="true" />
</head>

@{
    var today = DateTime.Today;
    string monthNameRaw = System.Globalization.CultureInfo.GetCultureInfo("ru-RU").DateTimeFormat.GetMonthName(Model.Month);
    string monthName = char.ToUpper(monthNameRaw[0]) + monthNameRaw.Substring(1);
}



<div class="month-navigation">
    <a href="@Url.Action("MySchedule", new { year = Model.Month == 1 ? Model.Year - 1 : Model.Year, month = Model.Month == 1 ? 12 : Model.Month - 1 })">« Предыдущий месяц</a>
    <h2>@monthName @Model.Year</h2>
    <a href="@Url.Action("MySchedule", new { year = Model.Month == 12 ? Model.Year + 1 : Model.Year, month = Model.Month == 12 ? 1 : Model.Month + 1 })">Следующий месяц »</a>
</div>

<div class="calendar-content">
<div class="form-calendar">
<table class="calendar">
    <thead>
        <tr>
            <th>Пн</th>
            <th>Вт</th>
            <th>Ср</th>
            <th>Чт</th>
            <th>Пт</th>
            <th>Сб</th>
            <th>Вс</th>
        </tr>
    </thead>
    <tbody>
        @{
            var firstDay = new DateTime(Model.Year, Model.Month, 1);
            var daysInMonth = DateTime.DaysInMonth(Model.Year, Model.Month);
            var startDayOfWeek = (int)firstDay.DayOfWeek;
            if (startDayOfWeek == 0) startDayOfWeek = 7;
        }
        <tr>
            @for (int i = 1; i < startDayOfWeek; i++)
            {
                <td></td>
            }
            @for (int day = 1; day <= daysInMonth; day++)
            {
                var date = new DateTime(Model.Year, Model.Month, day);
                var lesson = Model.Lessons.FirstOrDefault(l => l.Date.Date == date);
                var isLessonDay = lesson != null;
                var isAlertDay = Model.AlertDates.Contains(date);

                <td class="calendar-day" data-date="@date.ToString("yyyy-MM-dd")">
                    @if (isLessonDay)
                    {
                        <div class="lesson-day">@day</div>
                    }
                    else
                    {
                        @day
                    }
                    @if (date == today)
                    {
                        <div class="today"></div>
                    }
                    @if (isAlertDay)
                    {
                        <div class="alert-sign">!</div>
                    }
                </td>

                if ((startDayOfWeek + day - 1) % 7 == 0)
                {
                    @:</tr><tr>
                }
            }
        </tr>
    </tbody>
</table>
</div>

<div id="lessonDetails" class="lesson-details" style="margin-top: 20px; display:none;">
    <h3>Информация о занятиях</h3>
    <p><strong>Дата:</strong> <span id="lessonDate"></span></p>
    <ul id="lessonList"></ul>
</div>
</div>
<script>
    const lessons = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Lessons));

    document.querySelectorAll('.calendar-day').forEach(cell => {
        cell.addEventListener('click', () => {
            const date = cell.getAttribute('data-date');
            const filteredLessons = lessons.filter(l => l.Date.startsWith(date)); // Найти все занятия на дату

            if (filteredLessons.length > 0) {
                document.getElementById('lessonDetails').style.display = 'block';
                document.getElementById('lessonDate').innerText = date;

                // Очищаем список перед добавлением новых занятий
                const lessonList = document.getElementById('lessonList');
                lessonList.innerHTML = '';

                // Добавляем все занятия на дату
                filteredLessons.forEach(lesson => {
                    const [lessonDate, lessonTime] = lesson.Date.split('T');
                    const lessonItem = document.createElement('div');

                    lessonItem.innerHTML = `
                        <a href="/Teacher/AddAttendances?id=${lesson.Id}" class="lesson-link">Перейти к занятию</a><br>
                        <strong>Время:</strong> ${lessonTime.substring(0, 5)}<br>
                        <strong>Группа:</strong> ${lesson.GroupName}<br>
                        <strong>Предмет:</strong> ${lesson.CourseName}<br>
                        <strong>Преподаватель:</strong> ${lesson.Teacher}<br>
                        <hr>
                    `;
                    lessonList.appendChild(lessonItem);
                });
            } else {
                document.getElementById('lessonDetails').style.display = 'none';
            }
        });
    });
</script>

